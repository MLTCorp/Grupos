---
phase: 03-dashboard-shell
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - components/app-sidebar.tsx
  - components/dashboard-nav.tsx
  - components/bottom-nav.tsx
  - components/sidebar-header.tsx
  - components/nav-user.tsx
  - app/dashboard/layout.tsx
  - lib/navigation.ts
autonomous: true

must_haves:
  truths:
    - "User sees sidebar with 5 navigation items: Instancias, Categorias, Grupos, Mensagens, Agente"
    - "Sidebar collapses to icons when user clicks toggle"
    - "Sidebar state persists across page navigation"
    - "Mobile users see bottom navigation bar"
    - "Desktop users do not see bottom navigation"
    - "Disabled items appear visually distinct (opacity reduced)"
    - "Active page item has highlighted background"
    - "User can logout from sidebar user menu"
  artifacts:
    - path: "components/app-sidebar.tsx"
      provides: "Main sidebar with real navigation data"
      contains: "navigationItems"
    - path: "components/dashboard-nav.tsx"
      provides: "Flat navigation menu for sidebar"
      contains: "SidebarMenuButton"
    - path: "components/bottom-nav.tsx"
      provides: "Mobile bottom navigation"
      contains: "useIsMobile"
    - path: "components/sidebar-header.tsx"
      provides: "Sidebar header with logo and theme toggle"
      contains: "ThemeToggle"
    - path: "components/nav-user.tsx"
      provides: "User menu with logout action"
      contains: "signOut"
    - path: "app/dashboard/layout.tsx"
      provides: "Dashboard layout with SidebarProvider"
      contains: "SidebarProvider"
  key_links:
    - from: "app/dashboard/layout.tsx"
      to: "components/app-sidebar.tsx"
      via: "SidebarProvider wrapping AppSidebar"
      pattern: "SidebarProvider.*AppSidebar"
    - from: "components/app-sidebar.tsx"
      to: "components/dashboard-nav.tsx"
      via: "renders navigation menu"
      pattern: "DashboardNav"
    - from: "components/app-sidebar.tsx"
      to: "lib/navigation.ts"
      via: "imports navigation items"
      pattern: "navigationItems"
    - from: "components/bottom-nav.tsx"
      to: "hooks/use-mobile.ts"
      via: "useIsMobile hook for visibility"
      pattern: "useIsMobile"
    - from: "components/nav-user.tsx"
      to: "@/lib/supabase/client"
      via: "logout action"
      pattern: "createClient.*signOut"
---

<objective>
Create the navigation system with desktop sidebar and mobile bottom nav.

Purpose: Users navigate between app sections via sidebar (desktop) or bottom nav (mobile). Shows full app structure from day one with disabled items for upcoming features.
Output: Customized sidebar with real nav data, bottom nav for mobile, dashboard layout with SidebarProvider
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-dashboard-shell/03-CONTEXT.md
@.planning/phases/03-dashboard-shell/03-RESEARCH.md
@components/app-sidebar.tsx
@components/nav-main.tsx
@components/nav-user.tsx
@app/dashboard/logout-button.tsx
@components/ui/sidebar.tsx
@hooks/use-mobile.ts
@app/dashboard/layout.tsx
@components/theme-toggle.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Dashboard Navigation Components</name>
  <files>
    components/dashboard-nav.tsx
    components/sidebar-header.tsx
    lib/navigation.ts
  </files>
  <action>
Create navigation data file (lib/navigation.ts):
```typescript
import { Smartphone, FolderTree, Users, MessageSquare, Bot, CreditCard } from 'lucide-react'

export const navigationItems = [
  {
    title: 'Instancias',
    href: '/dashboard/instances',
    icon: Smartphone,
    disabled: false,  // Phase 4
  },
  {
    title: 'Categorias',
    href: '/dashboard/categories',
    icon: FolderTree,
    disabled: true,   // Phase 5
  },
  {
    title: 'Grupos',
    href: '/dashboard/groups',
    icon: Users,
    disabled: true,   // Phase 5
  },
  {
    title: 'Mensagens',
    href: '/dashboard/messages',
    icon: MessageSquare,
    disabled: true,   // Phase 6
  },
  {
    title: 'Agente',
    href: '/dashboard/agent',
    icon: Bot,
    disabled: true,   // Phase 7
  },
]

export const settingsItems = [
  {
    title: 'Faturamento',
    href: '/dashboard/billing',
    icon: CreditCard,
    disabled: false,
  },
]
```

Create DashboardNav component (components/dashboard-nav.tsx):
- Client component
- Accept items prop with navigation array
- Use usePathname from next/navigation for active detection
- Render SidebarMenu with SidebarMenuItem for each item
- For each item:
  - Use Link from next/link for navigation (not <a>)
  - SidebarMenuButton with tooltip={item.title}
  - Icon + title text
  - Active state: compare pathname with item.href (use startsWith for nested routes)
  - Disabled state: opacity-50 and pointer-events-none when item.disabled
  - Add id attribute for onboarding tour targeting: id={`nav-${item.href.split('/').pop()}`}

Create SidebarHeader component (components/sidebar-header.tsx):
- Client component
- Display app logo (SG in rounded square) and name "Sincron Grupos"
- Include ThemeToggle button from Plan 01
- Collapse gracefully: When sidebar collapsed, show only logo
- Use useSidebar hook to detect collapsed state

Visual styling for nav items:
- Active: bg-sidebar-accent text-sidebar-accent-foreground
- Disabled: opacity-50 cursor-not-allowed
- Hover (enabled only): bg-sidebar-accent/50
  </action>
  <verify>
Files exist with correct exports:
- `grep -l "navigationItems" lib/navigation.ts`
- `grep -l "DashboardNav" components/dashboard-nav.tsx`
- `grep -l "SidebarHeader" components/sidebar-header.tsx`
- `grep "disabled: true" lib/navigation.ts` (should find 4 matches)
  </verify>
  <done>
Navigation data defines 5 main items + billing settings item.
DashboardNav renders items with active/disabled states.
SidebarHeader shows logo and theme toggle.
  </done>
</task>

<task type="auto">
  <name>Task 2: Customize Existing AppSidebar and NavUser, Create BottomNav</name>
  <files>
    components/app-sidebar.tsx
    components/nav-user.tsx
    components/bottom-nav.tsx
  </files>
  <action>
NOTE: AppSidebar and NavUser ALREADY EXIST in this project with professional shadcn/ui design. This task CUSTOMIZES them (replaces sample data with real navigation), not creates from scratch.

The only pattern we borrow from the existing codebase is the working logout implementation (createClient + signOut from app/dashboard/logout-button.tsx).

**Customize AppSidebar (components/app-sidebar.tsx):**
The file currently has SAMPLE data that needs to be replaced:
- Sample teams: "Acme Inc", "Acme Corp.", "Evil Corp."
- Sample navMain: "Playground", "Models", "Documentation", "Settings"
- Sample projects: "Design Engineering", "Sales & Marketing", "Travel"
- Sample user: "shadcn", "m@example.com"

Replace with real Sincron Grupos navigation:
- Remove all sample data imports and const data block
- Import navigationItems and settingsItems from @/lib/navigation
- Import DashboardNav from @/components/dashboard-nav
- Import SidebarHeader from @/components/sidebar-header (will be AppSidebarHeader internally)
- Accept user prop: { name: string, email: string } (passed from layout)

New structure:
```tsx
export function AppSidebar({ user, ...props }: AppSidebarProps) {
  return (
    <Sidebar collapsible="icon" {...props}>
      <SidebarHeader>
        <AppSidebarHeader /> {/* Logo + theme toggle */}
      </SidebarHeader>
      <SidebarContent>
        <SidebarGroup>
          <SidebarGroupLabel>Menu</SidebarGroupLabel>
          <DashboardNav items={navigationItems} />
        </SidebarGroup>
        <SidebarGroup className="mt-auto">
          <SidebarGroupLabel>Configuracoes</SidebarGroupLabel>
          <DashboardNav items={settingsItems} />
        </SidebarGroup>
      </SidebarContent>
      <SidebarFooter>
        <NavUser user={{ name: user.name, email: user.email, avatar: '' }} />
      </SidebarFooter>
      <SidebarRail />
    </Sidebar>
  )
}
```

**Customize NavUser (components/nav-user.tsx):**
The file currently has SAMPLE menu items that need to be replaced:
- "Upgrade to Pro" (Sparkles icon)
- "Account" (BadgeCheck icon)
- "Billing" (CreditCard icon)
- "Notifications" (Bell icon)
- "Log out" (LogOut icon) - text only, no action

Keep the existing shadcn/ui structure (Avatar, DropdownMenu, etc.) - it's well designed.
Replace sample items with real functionality:
- Remove: "Upgrade to Pro", "Account", "Notifications"
- Keep "Billing" - make it a Link to /dashboard/billing
- Replace static "Log out" with working logout action

For logout, use the established pattern from app/dashboard/logout-button.tsx:
```typescript
import { createClient } from '@/lib/supabase/client'
import { useRouter } from 'next/navigation'

// Inside NavUser component:
const router = useRouter()

const handleLogout = async () => {
  const supabase = createClient()
  await supabase.auth.signOut()
  router.push('/')
}

// In the DropdownMenuItem for Log out:
<DropdownMenuItem onClick={handleLogout}>
  <LogOut />
  Sair
</DropdownMenuItem>
```

**Create BottomNav (components/bottom-nav.tsx):**
- Client component
- Use useIsMobile hook from hooks/use-mobile.ts
- Return null if not mobile
- Fixed bottom bar: fixed bottom-0 left-0 right-0 h-16 z-50
- Background: bg-background border-t
- Flex container: flex items-center justify-around
- Map navigationItems (first 5 items, skip settings)
- Each item: Link with flex-col, icon size-5, text-xs label
- Active state: text-primary
- Disabled state: opacity-50 pointer-events-none
- Add safe area padding for notched phones: pb-safe (if available) or pb-4

Important: Bottom nav shows ONLY main nav items (Instancias, Categorias, Grupos, Mensagens, Agente), not settings items.
  </action>
  <verify>
Components properly customized and created:
- `grep -l "DashboardNav" components/app-sidebar.tsx` (confirms DashboardNav import)
- `grep -l "navigationItems" components/app-sidebar.tsx` (confirms navigation data import)
- `grep -l "signOut" components/nav-user.tsx` (confirms logout implementation)
- `grep -l "createClient" components/nav-user.tsx` (confirms Supabase client import)
- `grep -l "useIsMobile" components/bottom-nav.tsx`
- `grep -l "fixed bottom-0" components/bottom-nav.tsx`
- No sample data references in app-sidebar.tsx: `grep -v "Playground\|Models\|Documentation\|Acme\|shadcn" components/app-sidebar.tsx | head -5` (should show clean imports)
  </verify>
  <done>
AppSidebar customized to use real navigation data (sample data removed).
NavUser customized with working logout using createClient and signOut pattern.
BottomNav created for mobile navigation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update Dashboard Layout with SidebarProvider</name>
  <files>
    app/dashboard/layout.tsx
  </files>
  <action>
Completely restructure dashboard layout to use shadcn/ui sidebar system:

1. Import from @/components/ui/sidebar:
   - SidebarProvider
   - SidebarInset
   - SidebarTrigger

2. Import AppSidebar and BottomNav

3. Keep existing logic:
   - Supabase auth check
   - Subscription status check
   - Redirect logic for blocked/none

4. Replace current layout structure with sidebar layout:

```tsx
return (
  <SidebarProvider>
    <AppSidebar user={{ name: userName, email: user.email || '' }} />
    <SidebarInset>
      {/* Header inside inset area */}
      <header className="flex h-16 shrink-0 items-center gap-2 border-b px-4">
        <SidebarTrigger className="-ml-1" />
        <Separator orientation="vertical" className="mr-2 h-4" />
        <div className="flex-1" />
        <TrialBadge status={subscriptionInfo.status} daysRemaining={subscriptionInfo.daysRemaining} />
      </header>
      {/* Main content */}
      <main className="flex-1 p-4 pb-20 md:pb-4">
        {children}
      </main>
    </SidebarInset>
    <BottomNav />
  </SidebarProvider>
)
```

Key points:
- Remove old header with logo (moved to sidebar)
- SidebarTrigger provides collapse/expand control
- Add pb-20 on mobile for bottom nav clearance (pb-4 on md+)
- Trial badge stays visible in header
- Get user name from user.user_metadata.name or fallback to email prefix

5. Hide desktop sidebar on mobile:
The sidebar component already handles this via useSidebar isMobile, but ensure className includes "hidden md:flex" on Sidebar if needed.
  </action>
  <verify>
Layout works:
- `npm run dev` - visit http://localhost:3000/dashboard
- Sidebar visible on desktop
- Sidebar trigger expands/collapses sidebar
- Bottom nav visible on mobile (resize browser or use DevTools)
- Trial badge visible
- Main content has proper padding
  </verify>
  <done>
Dashboard uses SidebarProvider with collapsible sidebar.
SidebarTrigger controls collapse state.
BottomNav visible on mobile with proper content padding.
Trial badge remains visible in header.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` passes
2. Desktop view (>768px): Sidebar with 5 nav items + settings, collapsible
3. Mobile view (<768px): Bottom nav with 5 icons, no sidebar
4. Click nav items: Active state highlights, disabled items don't navigate
5. Sidebar collapse: Icons only mode, tooltip shows item name
6. Theme toggle in sidebar header works
7. Logout from user menu works (redirects to /)
</verification>

<success_criteria>
- DASH-01: Sidebar shows Instancias, Categorias, Grupos, Mensagens, Agente
- DASH-02: Sidebar collapses to icons, mobile shows bottom nav
- Navigation items have active/disabled visual states
- Theme toggle accessible in sidebar
- Logout works from sidebar user menu (uses Supabase signOut)
- Trial badge visible in header
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard-shell/03-02-SUMMARY.md`
</output>
