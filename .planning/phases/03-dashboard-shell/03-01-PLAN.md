---
phase: 03-dashboard-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/theme-provider.tsx
  - components/theme-toggle.tsx
  - app/layout.tsx
  - lib/toast.ts
autonomous: true

must_haves:
  truths:
    - "User can toggle between dark and light theme"
    - "Theme preference persists across browser sessions"
    - "User sees feedback notifications for actions"
  artifacts:
    - path: "components/theme-provider.tsx"
      provides: "next-themes wrapper component"
      contains: "ThemeProvider"
    - path: "components/theme-toggle.tsx"
      provides: "Theme toggle button"
      contains: "useTheme"
    - path: "app/layout.tsx"
      provides: "Root layout with providers"
      contains: "ThemeProvider"
      contains: "Toaster"
  key_links:
    - from: "app/layout.tsx"
      to: "components/theme-provider.tsx"
      via: "import and wrap children"
      pattern: "ThemeProvider"
    - from: "components/theme-toggle.tsx"
      to: "next-themes"
      via: "useTheme hook"
      pattern: "useTheme.*setTheme"
---

<objective>
Set up theming infrastructure and toast notifications for the dashboard.

Purpose: Enables dark/light mode toggle that persists across sessions and provides visual feedback system for user actions. Foundation for sidebar and onboarding.
Output: ThemeProvider wrapper, ThemeToggle button, Toaster configured in root layout
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-dashboard-shell/03-CONTEXT.md
@.planning/phases/03-dashboard-shell/03-RESEARCH.md
@app/layout.tsx
@components/ui/sonner.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Theme Provider and Toggle</name>
  <files>
    components/theme-provider.tsx
    components/theme-toggle.tsx
  </files>
  <action>
Create ThemeProvider wrapper component:
- Client component wrapping NextThemesProvider from next-themes (already installed v0.4.6)
- Pass through all props to NextThemesProvider
- Export as named export

Create ThemeToggle button component:
- Client component using useTheme hook from next-themes
- Button with ghost variant, icon size
- Show Sun icon in light mode, Moon icon in dark mode
- Use CSS transitions for icon rotation (Sun rotates and scales to 0 in dark, Moon opposite)
- Add mounted state check to avoid hydration mismatch (common pitfall)
- Screen reader text: "Alternar tema" (Portuguese)
- Import icons from lucide-react (Sun, Moon)

Pattern from research:
```typescript
"use client"
import { useTheme } from "next-themes"
import { useEffect, useState } from "react"

export function ThemeToggle() {
  const [mounted, setMounted] = useState(false)
  const { theme, setTheme } = useTheme()

  useEffect(() => setMounted(true), [])
  if (!mounted) return null // Avoid hydration mismatch

  return (
    <Button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}>
      ...
    </Button>
  )
}
```
  </action>
  <verify>
Files exist and export correctly:
- `grep -l "ThemeProvider" components/theme-provider.tsx`
- `grep -l "ThemeToggle" components/theme-toggle.tsx`
- `grep -l "useTheme" components/theme-toggle.tsx`
  </verify>
  <done>
ThemeProvider wraps next-themes provider.
ThemeToggle renders Sun/Moon button that toggles theme.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Root Layout with Providers</name>
  <files>
    app/layout.tsx
  </files>
  <action>
Update root layout to add ThemeProvider and Toaster:

1. Import ThemeProvider from @/components/theme-provider
2. Import Toaster from @/components/ui/sonner

3. Add suppressHydrationWarning to html element (prevents theme flash warning)
4. Remove hardcoded "dark" class from html element (ThemeProvider manages this)

5. Wrap body children with ThemeProvider:
   - attribute="class" (Tailwind dark mode uses class)
   - defaultTheme="dark" (user decision: start with dark)
   - enableSystem (allow system preference detection)
   - disableTransitionOnChange (prevent FOUC on theme change)

6. Add Toaster component inside ThemeProvider:
   - position="top-right" (CONTEXT.md decision)
   - richColors (better visual distinction)
   - No closeButton needed (auto-dismiss)

Structure:
```tsx
<html lang="pt-BR" suppressHydrationWarning className={...}>
  <body className={...}>
    <ThemeProvider attribute="class" defaultTheme="dark" enableSystem disableTransitionOnChange>
      {children}
      <Toaster position="top-right" richColors />
    </ThemeProvider>
  </body>
</html>
```

Also update metadata:
- title: "Sincron Grupos"
- description: "Automacao inteligente de grupos WhatsApp"
  </action>
  <verify>
Run dev server and verify:
- `npm run dev` starts without errors
- Visit http://localhost:3000, page loads
- Check html element has class="dark" or class="light" (managed by next-themes)
- Open DevTools console, no hydration warnings
  </verify>
  <done>
Root layout wraps app in ThemeProvider.
Toaster is rendered for toast notifications.
Metadata updated to project name.
No hydration errors in console.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Toast Helper Utility</name>
  <files>
    lib/toast.ts
  </files>
  <action>
Create a simple toast helper that enforces duration conventions from CONTEXT.md:

```typescript
import { toast } from 'sonner'

// Duration conventions from CONTEXT.md:
// - success: 3 seconds (quick feedback)
// - error: 7 seconds (more time to read)

export function showSuccess(message: string) {
  toast.success(message, { duration: 3000 })
}

export function showError(message: string) {
  toast.error(message, { duration: 7000 })
}
```

This helper ensures consistent toast durations across the app without remembering the values.
  </action>
  <verify>
File exists with exports:
- `grep -l "showSuccess" lib/toast.ts`
- `grep -l "showError" lib/toast.ts`
- `grep "duration: 3000" lib/toast.ts`
- `grep "duration: 7000" lib/toast.ts`
  </verify>
  <done>
Toast helper exports showSuccess (3s) and showError (7s) functions.
Durations match CONTEXT.md specifications.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` passes without errors
2. `npm run dev` - visit http://localhost:3000
3. Check DevTools console - no hydration warnings
4. Verify Toaster component renders (inspect DOM for sonner elements)
5. ThemeToggle ready for integration in Plan 02
</verification>

<success_criteria>
- ThemeProvider wraps entire app with dark default
- Toaster positioned top-right, ready for notifications
- Toast helper enforces 3s success / 7s error durations
- ThemeToggle component ready for sidebar integration
- No hydration warnings or build errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard-shell/03-01-SUMMARY.md`
</output>
